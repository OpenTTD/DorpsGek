# DorpsGek

[![GitHub License](https://img.shields.io/github/license/OpenTTD/dorpsgek)](https://github.com/OpenTTD/dorpsgek/blob/main/LICENSE)
[![GitHub Tag](https://img.shields.io/github/v/tag/OpenTTD/dorpsgek?include_prereleases&label=stable)](https://github.com/OpenTTD/dorpsgek/releases)
[![GitHub commits since latest release](https://img.shields.io/github/commits-since/OpenTTD/dorpsgek/latest/main)](https://github.com/OpenTTD/dorpsgek/commits/main)

[![GitHub Workflow Status (Testing)](https://img.shields.io/github/workflow/status/OpenTTD/dorpsgek/Testing/main?label=main)](https://github.com/OpenTTD/dorpsgek/actions?query=workflow%3ATesting)
[![GitHub Workflow Status (Publish Image)](https://img.shields.io/github/workflow/status/OpenTTD/dorpsgek/Publish%20image?label=publish)](https://github.com/OpenTTD/dorpsgek/actions?query=workflow%3A%22Publish+image%22)
[![GitHub Workflow Status (Deployments)](https://img.shields.io/github/workflow/status/OpenTTD/dorpsgek/Deployment?label=deployment)](https://github.com/OpenTTD/dorpsgek/actions?query=workflow%3A%22Deployment%22)

[![GitHub deployments (Production)](https://img.shields.io/github/deployments/OpenTTD/dorpsgek/production?label=production)](https://github.com/OpenTTD/dorpsgek/deployments)

DorpsGek is an IRC bot with several tasks:
- It bridges GitHub Events to IRC
- It handles channel moderation (`@op`, `@kick`, ..)
- It shows when someone was last seen (`@seen`)
- It logs channels for backlog reading

## Development

This server is based on [Limnoria](https://github.com/ProgVal/Limnoria).
Because of many issues and shortcomings in Limnoria, there are some quirks in this codebase.
For example, configuration is generated by the `dorpsgek` module, as otherwise it is nearly impossible to bring secrets inside the bot without storing them inside the git repository.

It is build and tested with Python 3.8.

### Running a local server

#### Dependencies

- Python3.8 or higher.

#### Preparing your venv

To start it, you are advised to first create a virtualenv:

```bash
python3 -m venv .env
.env/bin/pip install -r requirements.txt
```

#### Starting a local server

You can start the HTTP server by running:

```bash
.env/bin/python -m dorpsgek --port 8000 --channel dorpsgek-test
```

This will start the IRC bot and it will join `#dorpsgek-test` on OFTC.
See `--help` for further configuration.
Although you can start `supybot DorpsGek-generated.conf`, we strongly suggest to always use the `dorpsgek` module as bootstrap for starting the bot.

### Running via docker

```bash
docker build -t openttd/dorpsgek:local .
docker run --rm -p 127.0.0.1:8000:80 openttd/dorpsgek:local
```
